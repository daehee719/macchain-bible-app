# ğŸš€ Redis ìºì‹œ ê°€ì´ë“œ

## ğŸ“Š Redis ìºì‹œ ì‹œìŠ¤í…œ ê°œìš”

MacChain ì„œë¹„ìŠ¤ì— Redisë¥¼ í™œìš©í•œ ë¶„ì‚° ìºì‹œ ì‹œìŠ¤í…œì„ ë„ì…í–ˆìŠµë‹ˆë‹¤.

### ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚   Backend       â”‚    â”‚   Redis Cache   â”‚
â”‚   (React)       â”‚â—„â”€â”€â–ºâ”‚   (Spring Boot) â”‚â—„â”€â”€â–ºâ”‚   (Port 6380)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   PostgreSQL    â”‚
                       â”‚   (Port 5434)   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ì„¤ì • ì •ë³´

### Redis ì„œë²„ ì„¤ì •
- **í˜¸ìŠ¤íŠ¸**: localhost
- **í¬íŠ¸**: 6380 (ì™¸ë¶€), 6379 (ì»¨í…Œì´ë„ˆ ë‚´ë¶€)
- **ë°ì´í„°ë² ì´ìŠ¤**: 0
- **ë¹„ë°€ë²ˆí˜¸**: ì—†ìŒ
- **ì˜ì†ì„±**: AOF (Append Only File) í™œì„±í™”

### ìºì‹œ ì„¤ì •
- **ìºì‹œ íƒ€ì…**: Redis
- **ì§ë ¬í™”**: JSON (Jackson2JsonRedisSerializer)
- **í‚¤ ì§ë ¬í™”**: StringRedisSerializer

## ğŸ“‹ ìºì‹œ ì „ëµ

### 1. ë§¥ì²´ì¸ í”Œëœ ìºì‹œ (`mccheyne-plans`)
- **TTL**: 24ì‹œê°„
- **ìš©ë„**: ì½ê¸° í”Œëœ ë°ì´í„° (ë³€ê²½ ë¹ˆë„ ë‚®ìŒ)
- **í‚¤ í˜•ì‹**: `getTodayPlan_2025-09-30`

### 2. ì‚¬ìš©ì ì§„í–‰ë¥  ìºì‹œ (`user-progress`)
- **TTL**: 30ë¶„
- **ìš©ë„**: ì‚¬ìš©ìë³„ ì½ê¸° ì§„í–‰ë¥  (ë³€ê²½ ë¹ˆë„ ì¤‘ê°„)
- **í‚¤ í˜•ì‹**: `1_2025-09-30` (userId_date)

### 3. ì‚¬ìš©ì í†µê³„ ìºì‹œ (`user-statistics`)
- **TTL**: 2ì‹œê°„
- **ìš©ë„**: ì‚¬ìš©ì í†µê³„ ë°ì´í„° (ê³„ì‚° ë¹„ìš© ë†’ìŒ)
- **í‚¤ í˜•ì‹**: `statistics_1` (userId)

## ğŸš€ ì‚¬ìš©ë²•

### 1. ìºì‹œ ìë™ ì ìš©
```java
@Cacheable(value = "user-progress", key = "#userId + '_' + T(java.time.LocalDate).now().toString()")
public ResponseEntity<UserProgressResponse> getUserProgress(@PathVariable Long userId) {
    // ìë™ìœ¼ë¡œ ìºì‹œì—ì„œ ì¡°íšŒ, ì—†ìœ¼ë©´ DBì—ì„œ ì¡°íšŒ í›„ ìºì‹œì— ì €ì¥
}
```

### 2. ìºì‹œ ë¬´íš¨í™”
```java
@CacheEvict(value = "user-progress", key = "#userId + '_' + T(java.time.LocalDate).now().toString()")
public ResponseEntity<UserProgressResponse> updateUserProgress(...) {
    // ì—…ë°ì´íŠ¸ í›„ í•´ë‹¹ ìºì‹œ í‚¤ ë¬´íš¨í™”
}
```

### 3. ìˆ˜ë™ ìºì‹œ ê´€ë¦¬
```java
@Autowired
private RedisCacheService redisCacheService;

// ìºì‹œ ì¡°íšŒ
UserProgress progress = redisCacheService.get("user-progress", "1_2025-09-30", UserProgress.class);

// ìºì‹œ ì €ì¥
redisCacheService.put("user-progress", "1_2025-09-30", progress);

// ìºì‹œ ì œê±°
redisCacheService.evict("user-progress", "1_2025-09-30");
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### 1. ìºì‹œ í†µê³„ ì¡°íšŒ
```bash
curl http://localhost:8081/api/cache/stats
```

### 2. Redis CLI ëª…ë ¹ì–´
```bash
# Redis ì—°ê²°
redis-cli -p 6380

# ëª¨ë“  í‚¤ ì¡°íšŒ
KEYS *

# íŠ¹ì • íŒ¨í„´ í‚¤ ì¡°íšŒ
KEYS user-progress:*

# í‚¤ TTL í™•ì¸
TTL user-progress:1_2025-09-30

# í‚¤ ê°’ ì¡°íšŒ
GET user-progress:1_2025-09-30

# í‚¤ ì œê±°
DEL user-progress:1_2025-09-30
```

### 3. ìºì‹œ ê´€ë¦¬ API
```bash
# ìºì‹œ í†µê³„
GET /api/cache/stats

# íŠ¹ì • ìºì‹œ ì œê±°
DELETE /api/cache/{cacheName}/{key}

# ìºì‹œ ì „ì²´ ì œê±°
DELETE /api/cache/{cacheName}

# ìºì‹œ í‚¤ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
GET /api/cache/{cacheName}/{key}/exists
```

## ğŸ”§ ì„±ëŠ¥ ìµœì í™”

### 1. ì»¤ë„¥ì…˜ í’€ ì„¤ì •
```yaml
spring:
  data:
    redis:
      lettuce:
        pool:
          max-active: 8    # ìµœëŒ€ í™œì„± ì—°ê²°
          max-idle: 8      # ìµœëŒ€ ìœ íœ´ ì—°ê²°
          min-idle: 0      # ìµœì†Œ ìœ íœ´ ì—°ê²°
          max-wait: -1ms   # ìµœëŒ€ ëŒ€ê¸° ì‹œê°„
```

### 2. ì§ë ¬í™” ìµœì í™”
- **í‚¤**: StringRedisSerializer (ê°€ë²¼ì›€)
- **ê°’**: GenericJackson2JsonRedisSerializer (ìœ ì—°ì„±)

### 3. TTL ì „ëµ
- **ìì£¼ ë³€ê²½**: 30ë¶„ (user-progress)
- **ê°€ë” ë³€ê²½**: 2ì‹œê°„ (user-statistics)
- **ê±°ì˜ ë³€ê²½ ì•ˆë¨**: 24ì‹œê°„ (mccheyne-plans)

## ğŸš¨ ë¬¸ì œ í•´ê²°

### 1. Redis ì—°ê²° ì‹¤íŒ¨
```bash
# Redis ìƒíƒœ í™•ì¸
docker ps | grep redis

# Redis ë¡œê·¸ í™•ì¸
docker logs macchain-redis

# Redis ì¬ì‹œì‘
docker-compose restart redis
```

### 2. ìºì‹œ ë¯¸ìŠ¤ìœ¨ ë†’ìŒ
- TTL ì„¤ì • ê²€í† 
- ìºì‹œ í‚¤ íŒ¨í„´ í™•ì¸
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

### 3. ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
# Redis ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
redis-cli -p 6380 INFO memory

# ë©”ëª¨ë¦¬ ì •ì±… í™•ì¸
redis-cli -p 6380 CONFIG GET maxmemory-policy
```

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

### ì˜ˆìƒ ì„±ëŠ¥ í–¥ìƒ
- **API ì‘ë‹µ ì‹œê°„**: 50-80% ê°ì†Œ
- **ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜**: 60-90% ê°ì†Œ
- **ë™ì‹œ ì‚¬ìš©ì ì²˜ë¦¬**: 3-5ë°° ì¦ê°€

### ëª¨ë‹ˆí„°ë§ ì§€í‘œ
- **ìºì‹œ íˆíŠ¸ìœ¨**: > 80%
- **í‰ê·  ì‘ë‹µ ì‹œê°„**: < 100ms
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ **: < 70%

## ğŸ”„ ìºì‹œ ë¬´íš¨í™” ì „ëµ

### 1. TTL ê¸°ë°˜
- ìë™ ë§Œë£Œë¡œ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œì–´

### 2. ì´ë²¤íŠ¸ ê¸°ë°˜
- ë°ì´í„° ë³€ê²½ ì‹œ ì¦‰ì‹œ ë¬´íš¨í™”
- ì‹¤ì‹œê°„ ì¼ê´€ì„± ë³´ì¥

### 3. ìˆ˜ë™ ê´€ë¦¬
- ê´€ë¦¬ì ë„êµ¬ë¥¼ í†µí•œ ì„ íƒì  ë¬´íš¨í™”
- ë¬¸ì œ ìƒí™© ëŒ€ì‘

## ğŸš€ í™•ì¥ ê³„íš

### 1. Redis í´ëŸ¬ìŠ¤í„°
- ê³ ê°€ìš©ì„± í™•ë³´
- ìˆ˜í‰ í™•ì¥ ì§€ì›

### 2. ìºì‹œ ê³„ì¸µí™”
- L1: ë¡œì»¬ ìºì‹œ (Caffeine)
- L2: Redis ìºì‹œ
- L3: ë°ì´í„°ë² ì´ìŠ¤

### 3. ëª¨ë‹ˆí„°ë§ ê°•í™”
- Prometheus + Grafana
- ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ

---

**ì°¸ê³ **: Redis ìºì‹œëŠ” ì„±ëŠ¥ í–¥ìƒì˜ í•µì‹¬ ìš”ì†Œì…ë‹ˆë‹¤. ì •ê¸°ì ì¸ ëª¨ë‹ˆí„°ë§ê³¼ íŠœë‹ì´ í•„ìš”í•©ë‹ˆë‹¤.

